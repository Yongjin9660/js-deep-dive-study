# 13. 스코프
<br>

## 13.1 스코프란?
> 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위 (식별자가 유효한 범위)  
> 자바스크립트 엔진이 식별자를 검색할 때 사용하는 규칙  


<br>

``` jsx
function add(x, y) {

 // 매개변수는 함수 몸체 내부에서만 참조 가능
 // => 매개변수의 스코프 (유효범위) : 함수 몸체 내부
 console.log(x, y);     // 2 5
 return x + y; 
}

add(2, 5);

// 매개변수는 함수 몸체 내부에서만 참조 가능하기 때문에
// 함수 외부에서 참조하려고 하면 오류 발생
console.log(x, y);      // -> ReferenceError

```
-> 매개변수의 스코프 : 함수 몸체 내부  
<br>

```jsx
var var1 = 1;          // 가장 바깥 영역에 선언한 변수

if (true) {
  var var2 = 2;        // 코드 블록 내에서 선언한 변수
  if (true) {
    var var3 = 3;      // 중첩된 코드 블록 내에서 선언한 변수
  } 
}

function foo() {
  var var4 = 4;        // 함수 내에서 선언한 변수

  function bar() {
    var var5 = 5;      // 중첩된 함수 내에서 선언한 변수
  }
}

console.log(var1);     // 1
console.log(var2);     // 2
console.log(var3);     // 3
console.log(var4);     // ReferenceError
console.log(var5);     // ReferenceError
```

-> ```모든 식별자 (변수/함수/클래스 이름 등) 는 자신이 선언된 위치에 의해 스코프가 결정됨. ```  
<br>

``` jsx
// 코드 바깥 영역과 foo() 함수 내부에 같은 이름을 갖는 x 변수 선언  

var x = 'global';

function foo() {
  var x = 'local';
  console.log(x);     // local
}

foo();

console.log(x);       // global
```

- 코드의 가장 바깥 영역에 선언된 x 변수는 어디서든 참조 가능 => ```전역 스코프```
 
- foo 함수 내부에서 선언된 x 변수는 foo 함수 내부에서만 참조 가능 => ```함수 스코프```

- <em> 즉, 두 개의 x 변수는 식별자 이름이 동일하지만 <u> 스코프가 다른 별개의 변수</u> </em>  
<br>

``` ** 식별자 결정 ** ```

&ensp; : 자바스크립트 엔진이 스코프를 통해 어떤 변수를 참조할 것인지 결정하는 것.   
<br> 


``` jsx
// var 키워드로 선언된 변수는 같은 스코프 내에서 중복 선언 허용 O
function foo() {
  var x = 1;
  var x = 2;
  console.log(x)      // 2
}

foo();

// let 이나 const 키워드로 선언된 변수는 같은 스코프 내에서 중복 선언 허용 X
function bar() {
  var y = 1;
  var y = 2;          // SyntaxError
}

bar();
```

- ```var 키워드로 선언된 변수```  
-> 같은 스코프 내에서 <u>중복 선언 허용 O</u>

- ```let 또는 const 키워드로 선언된 변수```    
-> 같은 스코프 내에서 <u>중복 선언 허용 X</u>  
<br>

## 13.2 스코프의 종류
<br>

| 구분 | 설명 | 스코프 | 변수 |
| --- | --- | --- | --- |
| 전역 | 코드의 가장 바깥 영역 | 전역 스코프 | 전역 변수 |
| 지역 | 함수 몸체 내부 | 지역 스코프 | 지역 변수 |   
<br>

### *전역 : 코드의 가장 바깥 영역  
&ensp; -> 어디서든지 참조 가능

### *지역 : 함수 몸체 내부  
&ensp; -> 자신의 지역 스코프와 하위 지역 스코프에서만 참조 가능  
<br>


![img](https://media.vlpt.us/images/yunsungyang-omc/post/8508f171-6f55-4e43-ab72-2978fd3efa5b/image.png)

-> inner 함수 내부에서 선언된 x 변수를 참조하면  
- 이름이 같은 전역 변수 x를 참조하는 것 (X)  
- inner 함수 내부에서 선언된 x 변수 참조  (O)  

-> 자바스크립트 엔진이 ```스코프 체인```을 통해 참조할 변수를 검색했기 때문  
<br>

## 13.3  스코프 체인
> 스코프가 계층적으로 연결된 것.

<br>

<br>

![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FZsB6H%2FbtqZqqeXNc7%2Fufs7kKZUEci9ynrAyWFkJk%2Fimg.png)  
<br>

-> ```모든 스코프는 하나의 계층적 구조로 연결되며, 모든 지역 스코프의 최상위 스코프는 전역 스코프```

-> 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색함.  

- ### <em> 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조 가능
- ### 하위 스코프에서 유효한 변수를 상위 스코프에서 참조 불가능 </em>
<br>

## 13.4 함수 레벨 스코프
> ### 1) 지역 레벨 스코프 
> : 함수 몸체만이 아닌 모든 코드 블록 (if, for, while, try/catch 등) 이 지역 스코프를 만드는 특성  
> ex) C, 자바 등

<br>

> ### 2) 함수 레벨 스코프 
> : 오로지 함수의 코드 블록 (함수 몸체) 만을 지역 스코프로 인정하는 특성  
> ex) <em> 자바스크립트의 <u> var 키워드로 선언된 변수</u></em>  

<br>

``` jsx
var i = 10;

// for 문에서 선언한 i 는 지역 변수가 아닌 전역 변수 -> 중복 선언 
for (var i = 0; i < 5; i++) {
  console.log(i);
}


// 의도치 않게 변수의 값이 변경되는 부작용 발생
console.log(i);   // 5 
```

### -> var 키워드로 선언된 변수는 함수의 코드 블록 (함수 몸체) 만을 지역 스코프로 인정 ###  

### -> <em >함수 밖에서 var 키워드로 선언된 변수는 모두 전역 변수</em>    
<br>

## 13.5 렉시컬 스코프
<br>

### 1) 동적 스코프
> ``` 함수를 어디서 호출```했는지에 따라 함수의 상위 스코프 결정   

<br>

### 2) 렉시컬 스코프 (정적 스코프) 
> ``` 함수를 어디서 정의 ```했는지에 따라 함수의 상위 스코프 결정  
> -> 자바스크립트를 비롯한 대부분의 프로그래밍 언어는 렉시컬 스코프를 따름.

<br>

``` jsx
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo();      // 1
bar();      // 1
```

-> 동적 스코프를 적용한다면
- bar 함수의 상위 스코프는 foo 함수의 지역 스코프와 전역 스코프

-> 렉시컬 스코프 (정적 스코프) 를 적용한다면
- bar 함수의 상위 스코프는 전역 스코프  
<br>

### -> 함수 정의 (함수 선언문 또는 함수 표현식) 가 실행되어 생성된 함수 객체는 자신의 상위 스코프를 기억했다가 호출되면 기억해 놓은 상위 스코프를 참조함.  
<br>

```
- bar 함수는 전역에서 정의된 함수이고, 함수 선언문으로 정의했기 때문에 전역 코드가 실행되기 전에 먼저 평가되어 함수 객체가 생성됨.

- 이때 생성된 bar 함수 객체는 자신이 정의된 스코프, 즉 전역 스코프를 기억했다가 bar 함수가 호출되면 호출된 곳이 어디인지 관계없이 언제나 자신이 기억하고 있는 전역 스코프를 상위 스코프로 사용함.
```

<br><br>
** 이미지 출처 : https://velog.io/@yunsungyang-omc/JS-%EC%A0%84%EC%97%AD-%EB%B3%80%EC%88%98%EC%9D%98-%EB%AC%B8%EC%A0%9C%EC%A0%90  
https://codingfarm.tistory.com/455**